{"version":3,"sources":["../src/react-imgix-bg.jsx"],"names":["findNearestWidth","actualWidth","targetWidths","toFixed","dp","value","__shouldComponentUpdate","props","nextProps","contentRect","bounds","prevWidth","width","prevHeight","height","nextContentRect","nextBounds","nextWidth","nextHeight","console","log","customizer","oldProp","newProp","key","a","b","Array","isArray","undefined","isEqual","JSON","stringify","propsEqual","BackgroundImpl","measureRef","imgixParams","onLoad","disableLibraryParam","src","children","className","forcedWidth","w","forcedHeight","h","hasDOMDimensions","htmlAttributes","dpr","global","devicePixelRatio","ref","onRef","el","bothWidthAndHeightPassed","ar","neitherWidthNorHeightPassed","Math","ceil","isReady","commonProps","renderedSrc","rawSrc","params","srcOptions","fit","ixlib","PACKAGE_VERSION","style","backgroundImage","backgroundSize","React","Component","Background"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { withContentRect } from \"react-measure\";\nimport { PACKAGE_VERSION } from \"./constants\";\nimport constructUrl from \"./constructUrl\";\nimport extractQueryParams from \"./extractQueryParams\";\nimport findClosest from \"./findClosest\";\nimport targetWidths from \"./targetWidths\";\nimport { shallowEqual } from \"./common\";\n\nconst findNearestWidth = (actualWidth) =>\n  findClosest(actualWidth, targetWidths);\n\nconst toFixed = (dp, value) => +value.toFixed(dp);\n\nexport const __shouldComponentUpdate = (props, nextProps) => {\n  const contentRect = props.contentRect;\n  const bounds = contentRect.bounds;\n  const { width: prevWidth, height: prevHeight } = bounds;\n\n  const nextContentRect = nextProps.contentRect;\n  const nextBounds = nextContentRect.bounds;\n  const { width: nextWidth, height: nextHeight } = nextBounds;\n\n  // If neither of the previous nor next dimensions are present,\n  // re-render.\n  if (!nextWidth || !nextHeight || !prevWidth || !prevHeight) {\n    console.log('re-rendering 1');\n    return true;\n  }\n\n  // The component has been rendered at least twice by this point\n  // and both the previous and next dimensions should be defined.\n  // Only update if the nextWidth is greater than the prevWidth.\n  if (prevWidth && nextWidth && nextWidth > prevWidth) {\n    console.log('re-rendering 2');\n    return true;\n  }\n\n  // Similarly, only update if the next height is greater than\n  // the previous height.\n  if (prevHeight && nextHeight && nextHeight > prevHeight) {\n    console.log('re-rendering 3');\n    return true;\n  }\n\n  const customizer = (oldProp, newProp, key) => {\n    // these keys are ignored from prop checking process\n    if (key === \"contextRect\" || key === \"measure\" || key === \"measureRef\") {\n      return true;\n    }\n\n    if (key === \"children\") {\n      if (oldProp !== newProp) {\n        console.log('re-rendering 4', {oldProp, newProp});\n      }\n      return oldProp == newProp;\n    }\n\n    if (key === \"imgixParams\") {\n      const value = shallowEqual(oldProp, newProp, (a, b) => {\n        if (Array.isArray(a)) {\n          return shallowEqual(a, b);\n        }\n        return undefined;\n      });\n      if (!value) {\n        console.log('re-rendering 5', {oldProp, newProp});\n      }\n      return value;\n    }\n\n    if (key === \"htmlAttributes\") {\n      const value = shallowEqual(oldProp, newProp);\n      if (!value) {\n        console.log('re-rendering 6', {oldProp, newProp});\n      }\n      return value;\n    }\n\n    const value = shallowEqual(oldProp, newProp);\n    if (!value) {\n      const isEqual = JSON.stringify(oldProp) === JSON.stringify(newProp);\n      console.log('re-rendering 7 ' + key, {value, isEqual, oldProp, newProp});\n    }\n\n    return undefined; // handled by shallowEqual\n  };\n\n  // If we made it here, we need to check if the \"top-level\"\n  // props have changed (e.g. disableLibraryParam).\n  const propsEqual = shallowEqual(props, nextProps, customizer);\n\n  return !(propsEqual);\n}\n\nclass BackgroundImpl extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n\n  shouldComponentUpdate(nextProps) {\n    return __shouldComponentUpdate(this.props, nextProps);\n  }\n\n  render() {\n    const {\n      measureRef,\n      contentRect,\n      imgixParams = {},\n      onLoad,\n      disableLibraryParam,\n      src,\n      children,\n      className = \"\",\n    } = this.props;\n    const { w: forcedWidth, h: forcedHeight } = imgixParams;\n    const hasDOMDimensions =\n      contentRect.bounds.width != null && contentRect.bounds.height != null;\n    const htmlAttributes = this.props.htmlAttributes || {};\n    const dpr = toFixed(2, imgixParams.dpr || global.devicePixelRatio || 1);\n    const ref = htmlAttributes.ref;\n    const onRef = (el) => {\n      measureRef(el);\n      if (typeof ref === \"function\") {\n        ref(el);\n      }\n    };\n\n    const { width, height } = (() => {\n      const bothWidthAndHeightPassed =\n        forcedWidth != null && forcedHeight != null;\n\n      if (bothWidthAndHeightPassed) {\n        return { width: forcedWidth, height: forcedHeight };\n      }\n\n      if (!hasDOMDimensions) {\n        return { width: undefined, height: undefined };\n      }\n      const ar = contentRect.bounds.width / contentRect.bounds.height;\n\n      const neitherWidthNorHeightPassed =\n        forcedWidth == null && forcedHeight == null;\n      if (neitherWidthNorHeightPassed) {\n        const width = findNearestWidth(contentRect.bounds.width);\n        const height = Math.ceil(width / ar);\n        return { width, height };\n      }\n      if (forcedWidth != null) {\n        const height = Math.ceil(forcedWidth / ar);\n        return { width: forcedWidth, height };\n      } else if (forcedHeight != null) {\n        const width = Math.ceil(forcedHeight * ar);\n        return { width, height: forcedHeight };\n      }\n    })();\n    const isReady = width != null && height != null;\n\n    const commonProps = {\n      ...htmlAttributes,\n    };\n\n    if (!isReady) {\n      return (\n        <div\n          {...commonProps}\n          className={`react-imgix-bg-loading ${className}`}\n          ref={onRef}\n        >\n          {children}\n        </div>\n      );\n    }\n\n    const renderedSrc = (() => {\n      const [rawSrc, params] = extractQueryParams(src);\n      const srcOptions = {\n        ...params,\n        fit: \"crop\",\n        ...imgixParams,\n        ...(disableLibraryParam ? {} : { ixlib: `react-${PACKAGE_VERSION}` }),\n        width,\n        height,\n        dpr,\n      };\n\n      return constructUrl(rawSrc, srcOptions);\n    })();\n\n    const style = {\n      ...htmlAttributes.style,\n      backgroundImage: `url(${renderedSrc})`,\n      backgroundSize:\n        (htmlAttributes.style || {}).backgroundSize !== undefined\n          ? htmlAttributes.style.backgroundSize\n          : \"cover\",\n    };\n\n    return (\n      <div {...commonProps} className={className} ref={onRef} style={style}>\n        {children}\n      </div>\n    );\n  }\n}\nconst Background = withContentRect(\"bounds\")(BackgroundImpl);\n\nexport { Background, BackgroundImpl as __BackgroundImpl };\n"],"file":"react-imgix-bg.js"}